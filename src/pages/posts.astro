---
import "../styles/home.css";
import "../styles/posts.css";
import "../styles/page-transitions.css";
import Navigation from "../components/Navigation.astro";
import Footer from "../components/Footer.astro";
import { siteConfig } from "../config/site";

// Evidencias fijas
const evidencias = [
  { title: "Modelado", slug: "modelado" },
  { title: "NormalizaciÃ³n", slug: "normalizacion" },
  { title: "SQL", slug: "sql" },
  { title: "Proyecto", slug: "proyecto" },
];
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content={Astro.generator} />
    <title>Evidencias</title>
  </head>

  <body>
    <Navigation />

    <main class="posts-page">
      <div class="posts-container page-content">
        <div class="posts-header posts-header-animate">
          <h1 class="posts-title">Evidencias</h1>
          <p class="posts-subtitle">Listado de actividades</p>
        </div>

        <!-- Buscador -->
        <div class="search-filter-section posts-content-animate">
          <div class="search-box">
            <input
              type="text"
              placeholder="Buscar evidencia..."
              class="search-input"
              id="search-input"
            />
          </div>
        </div>

        <!-- Lista -->
        <div class="posts-list posts-content-animate">
          <div class="date-group">
            <div class="date-card">
              {
                evidencias.map((item) => (
                  <article class="post-item" data-post-id={item.slug}>
                    <div class="post-summary">
                      <div class="title-icon-left" />
                      <h3 class="post-title">
                        <span class="post-title-link">
                          {item.title}
                        </span>
                        <div class="title-icon-right" />
                      </h3>
                      <button
                        class="post-toggle"
                        aria-label="Toggle post details"
                      >
                        <span class="post-arrow">â†“</span>
                      </button>
                    </div>

                    <div class="post-details">
                      <div class="post-content-wrapper">
                        <div class="post-excerpt-wrapper">

                          {item.slug === "modelado" ? (
                            <>
                              <p class="post-excerpt">
                                Descarga los modelos realizados:
                              </p>

                              <div style="display:flex; flex-direction:column; gap:10px; margin-top:10px;">
                                <a 
                                  href="/pdfs/MODELO HOSPITAL.pdf" 
                                  download
                                  class="pdf-link"
                                >
                                  ðŸ“„ Descargar Modelo Hospital
                                </a>

                                <a 
                                  href="/pdfs/MODELO AEROLINEA.pdf" 
                                  download
                                  class="pdf-link"
                                >
                                  ðŸ“„ Descargar Modelo AerolÃ­nea
                                </a>
                              </div>
                            </>
                          ) : (
                            <p class="post-excerpt">
                              Sin contenido
                            </p>
                          )}

                        </div>
                      </div>
                    </div>
                  </article>
                ))
              }
            </div>
          </div>
        </div>
      </div>
    </main>

    <Footer />
  </body>
</html>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const pageContent = document.querySelector(".page-content");
    if (pageContent) pageContent.classList.add("visible");

    const header = document.querySelector(".posts-header-animate");
    if (header) header.classList.add("visible");

    const contentElements = document.querySelectorAll(".posts-content-animate");
    contentElements.forEach((el) => el.classList.add("visible"));

    const postToggles = document.querySelectorAll(".post-toggle");
    const postSummaries = document.querySelectorAll(".post-summary");

    postToggles.forEach((toggle) => {
      toggle.addEventListener("click", (e) => {
        e.stopPropagation();
        const postItem = toggle.closest(".post-item");
        if (postItem) {
          postItem.classList.toggle("expanded");
          const arrow = toggle.querySelector(".post-arrow");
          arrow.textContent = postItem.classList.contains("expanded")
            ? "â†‘"
            : "â†“";
        }
      });
    });

    postSummaries.forEach((summary) => {
      summary.addEventListener("click", (e) => {
        if (e.target.closest(".post-toggle")) return;

        const postItem = summary.closest(".post-item");
        if (postItem) {
          postItem.classList.toggle("expanded");
          const arrow = postItem.querySelector(".post-arrow");
          arrow.textContent = postItem.classList.contains("expanded")
            ? "â†‘"
            : "â†“";
        }
      });
    });

    const searchInput = document.getElementById("search-input");

    if (searchInput) {
      searchInput.addEventListener("input", (e) => {
        const searchTerm = e.target.value.toLowerCase();
        const postItems = document.querySelectorAll(".post-item");

        postItems.forEach((item) => {
          const title =
            item.querySelector(".post-title")?.textContent?.toLowerCase() || "";

          item.style.display = title.includes(searchTerm) ? "block" : "none";
        });
      });
    }
  });
</script>
